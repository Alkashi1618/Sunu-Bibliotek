name: Java CI/CD - Sunu Bibliotek

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout du code
      uses: actions/checkout@v3
      
    - name: â˜• Configuration JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
        
    - name: ðŸ“¦ Compilation avec Maven
      run: mvn clean compile -B
      
    - name: ðŸ§ª ExÃ©cution des tests
      run: mvn test -B
      continue-on-error: true
      
    - name: ðŸ“¦ Construction du package WAR
      run: mvn package -DskipTests -B
      
    - name: ðŸ“Š VÃ©rification de la construction
      run: |
        if [ -f target/*.war ]; then
          echo "âœ… Fichier WAR crÃ©Ã© avec succÃ¨s"
          ls -lh target/*.war
        else
          echo "âŒ Erreur : Fichier WAR non trouvÃ©"
          exit 1
        fi
        
    - name: ðŸ“¤ Upload de l'artefact WAR
      uses: actions/upload-artifact@v3
      with:
        name: sunubibliotek-war
        path: target/*.war
        retention-days: 5
        
    - name: ðŸ“‹ RÃ©sumÃ© de la construction
      run: |
        echo "### ðŸŽ‰ Construction rÃ©ussie!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Projet** : Sunu Bibliotek - Cyberboys" >> $GITHUB_STEP_SUMMARY
        echo "**Branch** : ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**Commit** : ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ“¦ **Artefact WAR** disponible dans les artifacts" >> $GITHUB_STEP_SUMMARY
